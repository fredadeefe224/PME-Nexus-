<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PME System - Premium Project Management</title>
    <!-- Modern Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Outfit:wght@400;600;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body class="dark-theme">

    <!-- Loading Screen: shown until auth check completes -->
    <div id="app-loader" class="app-loader">
        <div class="loader-content">
            <div class="loader-spinner"></div>
            <span class="loader-text">PME Nexus</span>
        </div>
    </div>

    <!-- Toast Notifications (system messages, not user reports/notifications) -->
    <div id="toast-container" class="toast-container"></div>

    <div class="app-background">
        <div class="blob blob-1"></div>
        <div class="blob blob-2"></div>
        <div class="blob blob-3"></div>
    </div>

    <!-- Navigation Bar -->
    <nav id="navbar" class="glass-nav hidden">
        <div class="nav-brand">
            <i data-lucide="layers"></i>
            <span>PME Nexus</span>
        </div>
        <div class="nav-links">
            <button id="nav-dashboard-btn" class="nav-btn active">
                <i data-lucide="layout-dashboard"></i> Dashboard
            </button>
            <button id="nav-projects-btn" class="nav-btn">
                <i data-lucide="folder-kanban"></i> Projects
            </button>
            <button id="nav-users-btn" class="nav-btn" style="display: none;">
                <i data-lucide="users"></i> User Management
            </button>
        </div>
        <div class="nav-user">
            <button id="theme-toggle-btn" class="icon-btn" title="Toggle Theme">
                <i data-lucide="sun" id="theme-icon-light" style="display: none;"></i>
                <i data-lucide="moon" id="theme-icon-dark"></i>
            </button>
            <button id="nav-notifications-btn" class="icon-btn" title="Notifications" style="position: relative;">
                <i data-lucide="bell"></i>
                <span id="unread-notifications-badge" class="badge"
                    style="position: absolute; top: -5px; right: -5px; background: var(--danger); color: white; border-radius: 50%; padding: 2px 6px; font-size: 0.7rem; display: none;">0</span>
            </button>
            <div class="user-info">
                <span id="current-user-name" class="user-name"></span>
                <span id="current-user-role" class="user-role badge"></span>
            </div>
            <button id="logout-btn" class="icon-btn" title="Logout">
                <i data-lucide="log-out"></i>
            </button>
        </div>
    </nav>

    <!-- Global Notifications Panel (accessible from any page) -->
    <div id="notifications-panel" class="notifications-panel-global glass-panel" style="display: none;">
        <div
            style="padding: 1.5rem; border-bottom: 1px solid var(--panel-border); display: flex; justify-content: space-between; align-items: center;">
            <h3
                style="font-family: var(--font-heading); font-size: 1.25rem; display: flex; align-items: center; gap: 0.5rem;">
                <i data-lucide="bell"></i> Notifications
            </h3>
            <button id="close-notifications-btn" class="icon-btn"><i data-lucide="x"></i></button>
        </div>
        <div id="notifications-container"
            style="padding: 1rem; overflow-y: auto; display: flex; flex-direction: column; gap: 1rem; flex: 1;">
            <!-- Notifications injected here -->
        </div>
    </div>

    <main class="main-content">
        <!-- View: Login -->
        <section id="login-view" class="view-section">
            <div class="auth-card glass-panel">
                <div class="auth-header">
                    <i data-lucide="hexagon" class="brand-icon"></i>
                    <h2>Welcome Back</h2>
                    <p>Enter your credentials to access the PME system</p>
                </div>
                <form id="login-form" class="auth-form">
                    <div class="input-group">
                        <label for="login-username">Username</label>
                        <div class="input-wrapper">
                            <i data-lucide="user"></i>
                            <input type="text" id="login-username" required placeholder="manager1">
                        </div>
                    </div>
                    <div class="input-group">
                        <label for="login-password">Password</label>
                        <div class="input-wrapper">
                            <i data-lucide="lock"></i>
                            <input type="password" id="login-password" required placeholder="••••••••">
                            <button type="button" class="password-toggle-btn" aria-label="Show password">
                                <i data-lucide="eye"></i>
                            </button>
                        </div>
                    </div>
                    <button type="submit" class="btn-primary glow-eff">Sign In</button>
                </form>
                <div class="auth-footer">
                    <p>Don't have an account? <button id="go-to-signup" class="btn-text">Sign Up</button></p>
                </div>
            </div>
        </section>

        <!-- View: Sign Up -->
        <section id="signup-view" class="view-section">
            <div class="auth-card glass-panel">
                <div class="auth-header">
                    <i data-lucide="hexagon" class="brand-icon"></i>
                    <h2>Create Account</h2>
                    <p>Join the next generation of project management</p>
                </div>
                <form id="signup-form" class="auth-form">
                    <div class="input-group">
                        <label for="signup-username">Username</label>
                        <div class="input-wrapper">
                            <i data-lucide="user"></i>
                            <input type="text" id="signup-username" required placeholder="Choose a username">
                        </div>
                    </div>
                    <div class="input-group">
                        <label for="signup-email">Email</label>
                        <div class="input-wrapper">
                            <i data-lucide="mail"></i>
                            <input type="email" id="signup-email" required placeholder="manager@example.com">
                        </div>
                    </div>
                    <div class="input-group">
                        <label for="signup-role">Role</label>
                        <div class="input-wrapper">
                            <i data-lucide="shield"></i>
                            <select id="signup-role" required>
                                <option value="Admin">Admin</option>
                                <option value="Project Manager" selected>Project Manager</option>
                                <option value="Viewer">Viewer</option>
                            </select>
                        </div>
                    </div>
                    <div class="input-group">
                        <label for="signup-password">Password</label>
                        <div class="input-wrapper">
                            <i data-lucide="lock"></i>
                            <input type="password" id="signup-password" required placeholder="••••••••">
                            <button type="button" class="password-toggle-btn" aria-label="Show password">
                                <i data-lucide="eye"></i>
                            </button>
                        </div>
                    </div>
                    <button type="submit" class="btn-primary glow-eff">Register</button>
                </form>
                <div class="auth-footer">
                    <p>Already have an account? <button id="go-to-login" class="btn-text">Sign In</button></p>
                </div>
            </div>
        </section>

        <!-- View: User Management -->
        <section id="users-view" class="view-section">
            <div class="view-header" style="flex-direction: column; align-items: flex-start; gap: 1rem;">
                <div>
                    <h1 class="page-title">User Management</h1>
                    <p class="page-subtitle">Manage all registered users and their access</p>
                </div>
                <div style="width: 100%; display: flex; justify-content: space-between; align-items: center;">
                    <div class="input-group" style="margin: 0; max-width: 400px; width: 100%;">
                        <div class="input-wrapper">
                            <i data-lucide="search"></i>
                            <input type="text" id="search-users-input" placeholder="Search by name or email...">
                        </div>
                    </div>
                </div>
            </div>

            <div class="glass-panel" style="padding: 1rem; overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse; text-align: left; color: var(--text-main);">
                    <thead>
                        <tr style="border-bottom: 1px solid var(--panel-border); font-family: var(--font-heading);">
                            <th style="padding: 1rem;">Full Name</th>
                            <th style="padding: 1rem;">Email</th>
                            <th style="padding: 1rem;">Role</th>
                            <th style="padding: 1rem;">Account Status</th>
                            <th style="padding: 1rem;">Date Joined</th>
                            <th style="padding: 1rem;">Last Login</th>
                            <th style="padding: 1rem; text-align: right;">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="users-table-body" style="font-family: var(--font-body); font-size: 0.95rem;">
                        <!-- Users injected here -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- View: Dashboard -->
        <section id="dashboard-view" class="view-section">
            <div class="view-header">
                <div>
                    <h1 class="page-title">Dashboard</h1>
                    <p class="page-subtitle">Overview of your active projects</p>
                </div>
                <button id="create-project-btn" class="btn-primary add-btn">
                    <i data-lucide="plus"></i> New Project
                </button>
            </div>

            <div class="projects-grid" id="projects-container">
                <!-- Projects injected here -->
            </div>
        </section>

        <!-- View: Projects -->
        <section id="projects-view" class="view-section">
            <div class="view-header">
                <div>
                    <h1 class="page-title">Projects</h1>
                    <p class="page-subtitle">View completed and ongoing projects</p>
                </div>
            </div>

            <!-- Section 1: Completed Projects -->
            <div class="projects-section">
                <div class="projects-section-header">
                    <div class="projects-section-title">
                        <i data-lucide="check-circle-2"></i>
                        <h2>Completed Projects</h2>
                    </div>
                    <div class="projects-filters">
                        <div class="filter-group">
                            <label for="filter-month">Month</label>
                            <select id="filter-month">
                                <option value="">All Months</option>
                                <option value="1">January</option>
                                <option value="2">February</option>
                                <option value="3">March</option>
                                <option value="4">April</option>
                                <option value="5">May</option>
                                <option value="6">June</option>
                                <option value="7">July</option>
                                <option value="8">August</option>
                                <option value="9">September</option>
                                <option value="10">October</option>
                                <option value="11">November</option>
                                <option value="12">December</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="filter-year">Year</label>
                            <select id="filter-year">
                                <option value="">All Years</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="glass-panel" style="padding: 0; overflow: hidden;">
                    <table class="projects-table" id="completed-projects-table">
                        <thead>
                            <tr>
                                <th>Project Name</th>
                                <th>Date Completed</th>
                                <th style="text-align: right;">Report</th>
                            </tr>
                        </thead>
                        <tbody id="completed-projects-body">
                            <!-- Completed projects injected here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Section 2: Projects In Progress -->
            <div class="projects-section" style="margin-top: 3rem;">
                <div class="projects-section-header">
                    <div class="projects-section-title">
                        <i data-lucide="loader"></i>
                        <h2>Projects In Progress</h2>
                    </div>
                </div>
                <div class="glass-panel" style="padding: 0; overflow: hidden;">
                    <table class="projects-table" id="in-progress-projects-table">
                        <thead>
                            <tr>
                                <th>Project Name</th>
                                <th>Current Stage</th>
                                <th>Completion</th>
                                <th>Deadline</th>
                            </tr>
                        </thead>
                        <tbody id="in-progress-projects-body">
                            <!-- In-progress projects injected here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>


        <!-- View: Project Detail -->
        <section id="project-detail-view" class="view-section">
            <div class="view-header">
                <div>
                    <button id="back-to-dashboard" class="btn-text back-btn">
                        <i data-lucide="arrow-left"></i> Back to Dashboard
                    </button>
                    <h1 class="page-title" id="detail-project-name">Project Name</h1>
                    <p class="page-subtitle" id="detail-project-desc">Project Description</p>
                </div>
                <div class="header-actions">
                    <div
                        style="display: flex; flex-direction: column; align-items: flex-end; gap: 0.5rem; margin-right: 1.5rem;">
                        <span id="project-report-status" class="badge"
                            style="background: rgba(255,255,255,0.1); color: var(--text-muted);">Report: Pending</span>
                        <div style="display: flex; gap: 0.5rem;" id="report-actions-container">
                            <button id="generate-report-btn" class="btn-primary"
                                style="padding: 0.4rem 0.75rem; font-size: 0.8rem; display: none;">
                                <i data-lucide="file-text" style="width: 14px; height: 14px;"></i> Generate Word Report
                            </button>
                            <a id="download-report-btn" class="btn-secondary"
                                style="padding: 0.4rem 0.75rem; font-size: 0.8rem; display: none;"
                                download="Project_Report.docx">
                                <i data-lucide="download" style="width: 14px; height: 14px;"></i> Download
                            </a>
                        </div>
                    </div>
                    <div class="progress-ring-container summary-progress">
                        <svg class="progress-ring" width="60" height="60">
                            <circle class="progress-ring__circle-bg" stroke="rgba(255,255,255,0.1)" stroke-width="4"
                                fill="transparent" r="26" cx="30" cy="30" />
                            <circle id="project-total-progress" class="progress-ring__circle" stroke="var(--primary)"
                                stroke-width="4" fill="transparent" r="26" cx="30" cy="30" />
                        </svg>
                        <span id="project-total-progress-text" class="progress-text">0%</span>
                    </div>
                    <button id="create-stage-btn" class="btn-secondary add-btn">
                        <i data-lucide="plus"></i> Add Stage
                    </button>
                </div>
            </div>

            <div class="stages-container">
                <div class="section-title">
                    <h3>Project Stages</h3>
                </div>
                <div class="stages-list" id="stages-container">
                    <!-- Stages injected here -->
                </div>
            </div>

            <div class="lessons-container" style="margin-top: 3rem;">
                <div class="section-title"
                    style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <h3>Lessons Learned</h3>
                    <button id="create-lesson-btn" class="btn-secondary add-btn">
                        <i data-lucide="plus"></i> Add Lesson
                    </button>
                </div>
                <div class="lessons-list" id="lessons-container"
                    style="display: flex; flex-direction: column; gap: 1rem;">
                    <!-- Lessons injected here -->
                </div>
            </div>
        </section>
    </main>

    <!-- Modal: Confirm Action -->
    <div id="modal-confirm-action" class="modal-backdrop hidden">
        <div class="modal glass-panel" style="max-width: 400px;">
            <div class="modal-header">
                <h3 id="confirm-action-title">Confirm Action</h3>
                <button class="icon-btn close-modal"><i data-lucide="x"></i></button>
            </div>
            <div class="modal-body">
                <p id="confirm-action-message"
                    style="margin-bottom: 1.5rem; color: var(--text-main); font-size: 0.95rem;"></p>
                <div style="display: flex; justify-content: flex-end; gap: 1rem;">
                    <button type="button" class="btn-secondary close-modal" id="cancel-action-btn">Cancel</button>
                    <button type="button" class="btn-primary" id="confirm-action-btn">Confirm</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Create Project -->
    <div id="modal-create-project" class="modal-backdrop hidden">
        <div class="modal glass-panel">
            <div class="modal-header">
                <h3>Create New Project</h3>
                <button class="icon-btn close-modal"><i data-lucide="x"></i></button>
            </div>
            <form id="form-create-project" class="modal-body">
                <div class="input-group">
                    <label>Project Name</label>
                    <input type="text" id="new-project-name" required placeholder="e.g. Website Redesign">
                </div>
                <div class="input-group">
                    <label>Description (optional)</label>
                    <textarea id="new-project-desc" rows="3" placeholder="Brief overview..."></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-text close-modal">Cancel</button>
                    <button type="submit" class="btn-primary">Create</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Create/Edit Stage -->
    <div id="modal-stage" class="modal-backdrop hidden">
        <div class="modal glass-panel">
            <div class="modal-header">
                <h3 id="modal-stage-title">Add Stage</h3>
                <button class="icon-btn close-modal"><i data-lucide="x"></i></button>
            </div>
            <form id="form-stage" class="modal-body">
                <input type="hidden" id="stage-id">
                <div class="input-group">
                    <label>Stage Name</label>
                    <input type="text" id="stage-name" required placeholder="e.g. Planning Phase">
                </div>
                <div class="form-row">
                    <div class="input-group">
                        <label>Planned Start</label>
                        <input type="date" id="stage-planned-start" required>
                    </div>
                    <div class="input-group">
                        <label>Planned End</label>
                        <input type="date" id="stage-planned-end" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="input-group">
                        <label>Actual Start</label>
                        <input type="date" id="stage-actual-start">
                    </div>
                    <div class="input-group">
                        <label>Actual End</label>
                        <input type="date" id="stage-actual-end">
                    </div>
                </div>
                <div class="form-row">
                    <div class="input-group">
                        <label>Progress (%)</label>
                        <input type="number" id="stage-progress" min="0" max="100" value="0" required>
                    </div>
                    <div class="input-group">
                        <label>Status (Auto-calculated)</label>
                        <input type="text" id="stage-status" disabled value="On Track">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-text close-modal">Cancel</button>
                    <button type="submit" class="btn-primary">Save Stage</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Log Delay -->
    <div id="modal-delay" class="modal-backdrop hidden">
        <div class="modal glass-panel">
            <div class="modal-header">
                <h3>Log Stage Delay</h3>
                <button class="icon-btn close-modal"><i data-lucide="x"></i></button>
            </div>
            <form id="form-delay" class="modal-body">
                <input type="hidden" id="delay-stage-id">
                <div class="input-group">
                    <label>Reason for Delay</label>
                    <textarea id="delay-reason" rows="3" required
                        placeholder="Describe why this stage is behind schedule..."></textarea>
                </div>
                <div class="input-group">
                    <label>Impact Description</label>
                    <textarea id="delay-impact" rows="3" required
                        placeholder="Describe the impact on the overall project..."></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-text close-modal">Cancel</button>
                    <button type="submit" class="btn-primary glow-eff"
                        style="background: var(--warning); box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);">Save
                        Record</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Lessons Learned -->
    <div id="modal-lesson" class="modal-backdrop hidden">
        <div class="modal glass-panel">
            <div class="modal-header">
                <h3>Add Lesson Learned</h3>
                <button class="icon-btn close-modal"><i data-lucide="x"></i></button>
            </div>
            <form id="form-lesson" class="modal-body">
                <div class="input-group">
                    <label>Related Stage (Optional)</label>
                    <select id="lesson-stage">
                        <option value="">General Project Lesson</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Lesson Description</label>
                    <textarea id="lesson-desc" rows="3" required placeholder="What was learned?"></textarea>
                </div>
                <div class="input-group">
                    <label>Recommendation</label>
                    <textarea id="lesson-rec" rows="3" required
                        placeholder="How should we apply this in the future?"></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-text close-modal">Cancel</button>
                    <button type="submit" class="btn-primary">Save Lesson</button>
                </div>
            </form>
        </div>
    </div>

    <script src="app.js"></script>
</body>

</html>